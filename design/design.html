<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç®€æ˜“HTMLè®¾è®¡å™¨åŸç†æ¼”ç¤º</title>
    <style>
        body { margin: 0; display: flex; height: 100vh; font-family: sans-serif; }
        
        /* 1. å·¦ä¾§ç‰©æ–™åŒº */
        .sidebar {
            width: 250px;
            background: #f0f0f0;
            padding: 20px;
            border-right: 1px solid #ccc;
        }
        .component-item {
            background: #fff;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            cursor: grab;
            display: flex;
            align-items: center;
        }
        .component-item:active { cursor: grabbing; }

        /* 2. ä¸­é—´ç”»å¸ƒåŒº */
        .canvas-container {
            flex: 1;
            padding: 40px;
            background: #e5e5e5;
            display: flex;
            justify-content: center;
        }
        .canvas {
            width: 400px;
            height: 600px;
            background: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }

        /* æ‹–æ‹½æ—¶çš„è§†è§‰æç¤º */
        .canvas.drag-over {
            border: 2px dashed #007bff;
            background: #f9fbfd;
        }

        /* ç”»å¸ƒå†…ç»„ä»¶æ ·å¼ */
        .render-node {
            border: 1px dashed transparent;
            padding: 5px;
            margin-bottom: 5px;
        }
        .render-node:hover {
            border: 1px dashed #007bff; /* æ¨¡æ‹Ÿé€‰ä¸­æ•ˆæœ */
        }
        
        /* å³ä¾§æ•°æ®é¢„è§ˆåŒºï¼ˆè¾…åŠ©ç†è§£åŸç†ï¼‰ */
        .json-preview {
            width: 300px;
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            font-family: monospace;
            font-size: 12px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <button onclick="saveAndPreview()">ğŸ’¾ ä¿å­˜å¹¶é¢„è§ˆ</button>

    <!-- å·¦ä¾§ï¼šç»„ä»¶åº“ -->
    <div class="sidebar">
        <h3>ç»„ä»¶åº“</h3>
        <!-- draggable="true" æ˜¯åŸç”Ÿæ‹–æ‹½çš„å…³é”® -->
        <div class="component-item" draggable="true" data-type="text">
            ğŸ“„ æ–‡æœ¬ç»„ä»¶
        </div>
        <div class="component-item" draggable="true" data-type="button">
            ğŸ”˜ æŒ‰é’®ç»„ä»¶
        </div>
        <div class="component-item" draggable="true" data-type="image">
            ğŸ–¼ï¸ å›¾ç‰‡ç»„ä»¶
        </div>
    </div>

    <!-- ä¸­é—´ï¼šç”»å¸ƒ -->
    <div class="canvas-container">
        <div id="canvas" class="canvas">
            <!-- è¿™é‡Œå°†ç”± JS åŠ¨æ€æ¸²æŸ“ -->
        </div>
    </div>

    <!-- å³ä¾§ï¼šJSON æ•°æ®æ¨¡å‹ï¼ˆå±•ç¤ºæ ¸å¿ƒåŸç†ï¼‰ -->
    <div class="json-preview">
        <h3>JSON æ•°æ®æ¨¡å‹ (Schema)</h3>
        <pre id="json-display"></pre>
    </div>

    <script>
        // ==========================================
        // 1. æ•°æ®æ¨¡å‹ (Model)
        // ==========================================
        // è®¾è®¡å™¨çš„æ ¸å¿ƒä¸æ˜¯ DOMï¼Œè€Œæ˜¯è¿™ä¸ªæ•°ç»„ã€‚
        let pageData = [];

        // ==========================================
        // 2. æ‹–æ‹½å¼•æ“ (Engine)
        // ==========================================
        
        const sidebarItems = document.querySelectorAll('.component-item');
        const canvas = document.getElementById('canvas');
        const jsonDisplay = document.getElementById('json-display');

        // A. å¼€å§‹æ‹–æ‹½ (Source)
        sidebarItems.forEach(item => {
            item.addEventListener('dragstart', (e) => {
                // å‘Šè¯‰æµè§ˆå™¨æˆ‘ä»¬æ‹–çš„æ˜¯ä»€ä¹ˆç±»å‹ï¼ˆtext/button/imageï¼‰
                e.dataTransfer.setData('componentType', item.dataset.type);
                e.dataTransfer.effectAllowed = 'copy';
            });
        });

        // B. æ‹–æ‹½ç»è¿‡ç”»å¸ƒ (Target Over)
        canvas.addEventListener('dragover', (e) => {
            // å¿…é¡»é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œå¦åˆ™æ— æ³•è§¦å‘ drop äº‹ä»¶
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
            canvas.classList.add('drag-over'); // æ·»åŠ é«˜äº®æ ·å¼
        });

        canvas.addEventListener('dragleave', () => {
            canvas.classList.remove('drag-over');
        });

        // C. æ”¾ç½® (Drop) - æ ¸å¿ƒé€»è¾‘
        canvas.addEventListener('drop', (e) => {
            e.preventDefault();
            canvas.classList.remove('drag-over');
            
            // 1. è·å–æ‹–è¿‡æ¥çš„æ•°æ®ç±»å‹
            const type = e.dataTransfer.getData('componentType');
            debugger;
            if (type) {
                // 2. åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹æ•°æ® (Node)
                const newNode = createNodeData(type);
                
                // 3. æ›´æ–°æ•°æ®æ¨¡å‹ (Model)
                pageData.push(newNode);
                
                // 4. è§¦å‘æ¸²æŸ“ (View)
                renderCanvas();
            }
        });

        // ==========================================
        // 3. è¾…åŠ©å‡½æ•°
        // ==========================================

        // å·¥å‚å‡½æ•°ï¼šæ ¹æ®ç±»å‹ç”Ÿæˆ JSON å¯¹è±¡
        function createNodeData(type) {
            const id = 'node_' + Date.now();
            if (type === 'text') {
                return { id, type: 'text', content: 'è¿™é‡Œæ˜¯ä¸€æ®µæ–‡æœ¬', style: 'color: #333; font-size: 16px;' };
            } else if (type === 'button') {
                return { id, type: 'button', content: 'ç‚¹å‡»æˆ‘', style: 'background: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 4px;' };
            } else if (type === 'image') {
                return { id, type: 'image', src: 'https://via.placeholder.com/300x150', style: 'width: 100%; display: block;' };
            }
        }

        // ==========================================
        // 4. æ¸²æŸ“å™¨ (Renderer) - æ¨¡æ‹Ÿ React/Vue çš„å·¥ä½œ
        // ==========================================
        function renderCanvas() {
            // 1. æ¸…ç©ºç”»å¸ƒ
            canvas.innerHTML = '';
            debugger;
            // 2. éå†æ•°æ®æ¨¡å‹ç”ŸæˆçœŸå® DOM
            pageData.forEach(node => {
                const elWrapper = document.createElement('div');
                elWrapper.className = 'render-node';
                
                let el;
                if (node.type === 'text') {
                    el = document.createElement('p');
                    el.innerText = node.content;
                } else if (node.type === 'button') {
                    el = document.createElement('button');
                    el.innerText = node.content;
                } else if (node.type === 'image') {
                    el = document.createElement('img');
                    el.src = node.src;
                }

                // åº”ç”¨æ ·å¼
                el.style = node.style;
                
                elWrapper.appendChild(el);
                canvas.appendChild(elWrapper);
            });

            // 3. åŒæ­¥æ›´æ–°å³ä¾§ JSON æ˜¾ç¤º
            jsonDisplay.innerText = JSON.stringify(pageData, null, 2);
        }

        // åˆå§‹åŒ–æ¸²æŸ“
        renderCanvas();

        function saveAndPreview() {
            // 1. åºåˆ—åŒ–ï¼šå°† JSON å¯¹è±¡è½¬ä¸ºå­—ç¬¦ä¸²
            const jsonString = JSON.stringify(pageData);
            
            // 2. å­˜å‚¨ï¼šæ¨¡æ‹Ÿå­˜å…¥æ•°æ®åº“ï¼ˆè¿™é‡Œç”¨ LocalStorage ä»£æ›¿ï¼‰
            localStorage.setItem('page_schema', jsonString);
            
            // 3. è·³è½¬ï¼šæ‰“å¼€é¢„è§ˆé¡µï¼ˆruntime.htmlï¼‰
            window.open('preview.html', '_blank');
        }

    </script>
</body>
</html>